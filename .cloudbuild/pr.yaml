steps:
  - id: redpanda
    name: 'vectorized/redpanda:latest'
    args: [ 'redpanda', 'start',  '--overprovisioned', '--smp 1 ',  '--memory 1G', '--reserve-memory 0M', '--node-id 0',  '--check=false' ]
    entryPoint: /usr/bin/rpk
  - id: mosquitto
    name: 'eclipse-mosquitto:2'
  - id: build
    name: 'gcr.io/cloud-builders/docker'
    args: [ 'build', '--tag=eu.gcr.io/${PROJECT_ID}/${REPO_NAME}:${BRANCH_NAME}-${SHORT_SHA}', '.' ]
    waitFor: [redpanda, mosquitto]

images: [ 'eu.gcr.io/${PROJECT_ID}/${REPO_NAME}:${BRANCH_NAME}-${SHORT_SHA}' ]
